# Xui bớt - Telegram VPN Bot

Xui bớt — это телеграм-бот для управления VPN-серверами и подписками, с интеграцией для проверки статусов серверов и оплаты через криптовалюты. Бот предоставляет веб-интерфейс для администрирования, API для внутренней коммуникации и мониторинг через Grafana.

## Сервисы

### 1. **Web** - [http://localhost:80](http://localhost:80)
    **Описание**:  
    Веб-панель для добавления серверов в базу данных в формате `{ip:pass}`. Поддерживается добавление серверов в многострочном режиме. Это основной интерфейс для администраторов VPN-серверов.

### 2. **API** - [http://localhost:8000](http://localhost:8000)
    **Описание**:  
    Реализован на FastAPI (offline режим). Предоставляет API для взаимодействия с ботом, checker'ом и веб-панелью. Используется для внутренней коммуникации между сервисами.

### 3. **Checker**
    **Описание**:  
    Сервис для проверки статусов серверов и обработки платежей криптобота.  
    - **Проверка серверов**: Контейнер с бесконечным циклом, пингует порты `22` и `2053` у серверов. Если сервер недоступен, отправляется запрос в API для обновления статуса сервера на `False` (offline).
    - **Проверка платежей**: Checker также следит за изменениями статусов оплаты в криптоботе. Если статус изменяется на `paid`, обновляет его в базе данных и в зависимости от подписки пользователя добавляет соответствующее время.

### 4. **Bot**
    **Описание**:  
    Контейнер с Telegram-ботом, который обрабатывает всю логику взаимодействия с пользователями: кнопки, хендлеры и команды. Вся внутренняя коммуникация происходит через API контейнер. Бот поддерживает два языка для пользователей.

### 5. **PostgreSQL**
    **Описание**:  
    Контейнер с базой данных PostgreSQL, которая используется для хранения информации о серверах, пользователях и статусах подписок.

### 6. **Grafana** - [http://localhost:3000](http://localhost:3000)
    **Описание**:  
    Grafana используется для мониторинга логов и их визуализации. Логи собираются через связку `Loki` и `Promtail`.  
    Для настройки Grafana:
    1. Зайдите в Grafana и выберите `Add new connections`.
    2. Выберите `Loki` и укажите его хост как `http://loki:3100`.
    3. После подключения, зайдите в `Explore`, выберите `Loki`, затем в `Label filters` выберите `job = docker`, и нажмите `Live` для просмотра логов в реальном времени.

## Запуск проекта

Для запуска всех сервисов используйте команду:

```bash
docker compose up --build
```

Это развернёт все необходимые контейнеры (web, API, checker, bot, PostgreSQL, Grafana) и подготовит окружение для работы телеграм-бота и админ-панели.

## Возможности

- Добавление VPN-серверов через веб-интерфейс.
- Управление статусами серверов (online/offline) в реальном времени.
- Интеграция с криптоботом для обработки платежей и управления подписками.
- Мониторинг и логирование через Grafana для удобного управления.

Этот проект предоставляет полный стек для управления VPN-серверами через Telegram, с проверкой статусов серверов, поддержкой криптоплатежей и удобным мониторингом через Grafana.